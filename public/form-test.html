<!DOCTYPE html>
<html>
<head>
    <title>Form-Based Barber Login Test</title>
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
    <meta http-equiv="Pragma" content="no-cache" />
    <meta http-equiv="Expires" content="0" />
</head>
<body>
    <h1>ğŸ“ Form-Based Barber Login Test</h1>
    <p>This test uses a simple HTML form to test the login.</p>

    <form id="loginForm" action="http://206.189.57.55:8001/api/v1/auth/login" method="POST" target="resultFrame">
        <input type="hidden" name="username" value="testbarber@test.com" />
        <input type="hidden" name="password" value="test123" />

        <button type="submit" style="padding: 15px 30px; font-size: 18px; background: #00a693; color: white; border: none; border-radius: 5px;">
            ğŸ” Test Login with Form
        </button>
    </form>

    <iframe name="resultFrame" id="resultFrame" style="width: 100%; height: 400px; border: 2px solid #ccc; margin-top: 20px;"></iframe>

    <div style="margin-top: 20px; padding: 10px; background: #f0f0f0;">
        <h3>ğŸ“‹ Test Information:</h3>
        <p><strong>Form Action:</strong> http://206.189.57.55:8001/api/v1/auth/login</p>
        <p><strong>Method:</strong> POST</p>
        <p><strong>Content-Type:</strong> application/x-www-form-urlencoded</p>
        <p><strong>Username:</strong> testbarber@test.com</p>
        <p><strong>Password:</strong> test123</p>
    </div>

    <script>
        // Log when form is submitted
        document.getElementById('loginForm').addEventListener('submit', function() {
            console.log('ğŸ“ Form submitted');
            document.getElementById('resultFrame').onload = function() {
                console.log('ğŸ“ Form response loaded');
                try {
                    const iframeDoc = this.contentDocument || this.contentWindow.document;
                    const responseText = iframeDoc.body.textContent || iframeDoc.body.innerText;
                    console.log('ğŸ“ Raw response:', responseText);

                    // Try to parse JSON
                    try {
                        const jsonResponse = JSON.parse(responseText);
                        console.log('ğŸ“ Parsed response:', jsonResponse);

                        if (jsonResponse.access_token) {
                            alert('âœ… LOGIN SUCCESSFUL! Token: ' + jsonResponse.access_token.substring(0, 20) + '...');
                        } else {
                            alert('âŒ LOGIN FAILED: ' + (jsonResponse.detail || 'Unknown error'));
                        }
                    } catch (e) {
                        console.error('âŒ Failed to parse response as JSON:', e);
                        alert('âŒ Invalid response format: ' + responseText);
                    }
                } catch (e) {
                    console.error('âŒ Cannot access iframe content:', e);
                    alert('âŒ Cannot read response. Check browser security settings.');
                }
            };
        });
    </script>
</body>
</html>